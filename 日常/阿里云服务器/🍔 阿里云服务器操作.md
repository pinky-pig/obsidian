
> https://github.com/amandakelake/blog/issues/102
> https://juejin.cn/post/7250044070671695930?searchId=2023111022561541C2C4478F32C65D406C#heading-1
>https://github.com/amandakelake/blog/issues/104


> æ”¾æ–‡ä»¶: /usr/share/nginx/



### åŸºç¡€

- **è¿æ¥**

```bash
ssh root@47.116.13.177
```

- **æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬**

```bash
# CentOS linux release 7.9.2009 (Core)
cat /etc/redhat-release
```

- **ä¸‹è½½è½¯ä»¶**

```bash
# æŸ¥çœ‹æ˜¯å¦è”ç½‘
ping www.baidu.com

yum install wget curl git vim iptables-services net-tools lsof
```

- **éƒ¨ç½² Node.js ç¯å¢ƒ**
- **é…ç½® Nginx**


### **éƒ¨ç½²Node.jsç¯å¢ƒ**


**1. ä½¿ç”¨NVMå®‰è£…å¤šä¸ªNode.jsç‰ˆæœ¬**

 >NVMï¼ˆNodeÂ VersionÂ Managerï¼‰æ˜¯Node.jsçš„ç‰ˆæœ¬ç®¡ç†è½¯ä»¶ï¼Œä½¿æ‚¨å¯ä»¥è½»æ¾åœ¨Node.jså„ä¸ªç‰ˆæœ¬é—´è¿›è¡Œåˆ‡æ¢ã€‚é€‚ç”¨äºé•¿æœŸåšnodeå¼€å‘çš„äººå‘˜æˆ–æœ‰å¿«é€Ÿæ›´æ–°nodeç‰ˆæœ¬ã€å¿«é€Ÿåˆ‡æ¢nodeç‰ˆæœ¬çš„åœºæ™¯ã€‚å…·ä½“æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š

**a.Â å®‰è£…åˆ†å¸ƒå¼ç‰ˆæœ¬ç®¡ç†ç³»ç»ŸGitã€‚**

```bash
yumÂ installÂ gitÂ -y
```

**b.Â ä½¿ç”¨Gitå°†NVMçš„æºç å…‹éš†åˆ°æœ¬åœ°çš„~/.nvmç›®å½•ä¸‹ï¼Œå¹¶æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬ã€‚**

> è¯´æ˜ï¼šç”±äºç½‘ç»œåŸå› ï¼Œå¯èƒ½ä¼šå‡ºç°æ— æ³•å…‹éš†çš„é—®é¢˜ï¼Œå»ºè®®æ‚¨å¤šå°è¯•å‡ æ¬¡ã€‚

```bash
gitÂ cloneÂ https://gitee.com/mirrors/nvm.gitÂ ~/.nvmÂ &&Â cdÂ ~/.nvmÂ &&Â gitÂ checkoutÂ `gitÂ describeÂ --abbrev=0Â --tags`
```

**c.Â ä¾æ¬¡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œé…ç½®NVMçš„ç¯å¢ƒå˜é‡ã€‚**

```bash
echoÂ ".Â ~/.nvm/nvm.sh"Â >>Â /etc/profile
sourceÂ /etc/profile
```

**d.Â è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¿®æ”¹npmé•œåƒæºä¸ºé˜¿é‡Œäº‘é•œåƒï¼Œä»¥åŠ å¿«Node.jsä¸‹è½½é€Ÿåº¦ã€‚**

```bash
exportÂ NVM_NODEJS_ORG_MIRROR=https://npmmirror.com/mirrors/node
```

**e.Â è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹Node.jsç‰ˆæœ¬ã€‚**

```bash
nvmÂ list-remote
```

**f.Â å®‰è£…å¤šä¸ªNode.jsç‰ˆæœ¬ã€‚**

Â Â Â Â Â Â Â Â i.Â å®‰è£…v14.0.0ç‰ˆæœ¬ã€‚

```bash
nvmÂ installÂ v14.0.0
```

Â Â Â Â Â Â Â Â ii.Â å®‰è£…v16.0.0ç‰ˆæœ¬ã€‚

```bash
nvmÂ installÂ v16.0.0
```

**g.Â æŸ¥çœ‹å·²å®‰è£…çš„Node.jsç‰ˆæœ¬ã€‚**

```bash
nvmÂ ls
```

> è¿”å›ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼Œè¡¨ç¤ºå½“å‰å·²å®‰è£…v14.0.0ã€v16.0.0ä¸¤ä¸ªç‰ˆæœ¬ï¼Œæ­£åœ¨ä½¿ç”¨çš„æ˜¯v16.0.0ç‰ˆæœ¬ã€‚

```
Â Â Â Â Â Â Â Â v14.0.0
->Â Â Â Â Â Â v16.0.0
defaultÂ ->Â v14.0.0
iojsÂ ->Â N/AÂ (default)
unstableÂ ->Â N/AÂ (default)
nodeÂ ->Â stableÂ (->Â v16.0.0)Â (default)
stableÂ ->Â 16.0Â (->Â v16.0.0)Â (default)
lts/*Â ->Â lts/hydrogenÂ (->Â N/A)
lts/argonÂ ->Â v4.9.1Â (->Â N/A)
lts/boronÂ ->Â v6.17.1Â (->Â N/A)
lts/carbonÂ ->Â v8.17.0Â (->Â N/A)
lts/dubniumÂ ->Â v10.24.1Â (->Â N/A)
lts/erbiumÂ ->Â v12.22.12Â (->Â N/A)
lts/fermiumÂ ->Â v14.21.3Â (->Â N/A)
lts/galliumÂ ->Â v16.20.1Â (->Â N/A)
lts/hydrogenÂ ->Â v18.16.1Â (->Â N/A)
```

Â Â Â Â Â Â Â Â è¯´æ˜ï¼šæ‚¨å¯ä»¥è¿è¡ŒnvmÂ useÂ <ç‰ˆæœ¬å·>å‘½ä»¤åˆ‡æ¢Node.jsçš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œåˆ‡æ¢è‡³Node.jsÂ v18.0.0ç‰ˆæœ¬çš„å‘½ä»¤ä¸ºnvmÂ useÂ v18.0.0ã€‚

### **å®‰è£… Nginx**

**1. å¼€å¯ Nginx ç«¯å£ï¼Œæ·»åŠ  80 ç«¯å£**

![[Pasted image 20231201115439.png]]

**2.å®‰è£… Nginx ä¾èµ–åº“**

```bash
yum install openssl zlib pcre
```

**3. å®‰è£… Nginx åº“Â **

```bash
rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm
```

**4. æ‰§è¡Œå®‰è£… Nginx **

```bash
yum install nginx
```

**5. å¯åŠ¨æœåŠ¡**

```bash
systemctl start nginx
```

**6. æŸ¥çœ‹æœåŠ¡çŠ¶æ€**

```bash
systemctl status nginx
```

ç„¶åè®¿é—®å…¬ç½‘ipå³å¯


**7. ä½¿ç”¨ [File Zilla](https://filezilla-project.org/download.php?type=client) å‘é€æ–‡ä»¶**

æ–‡ä»¶ç›®å½•æ”¾åˆ°è¿™é‡Œ `/usr/share/nginx/marry-travel-photos`

![[Pasted image 20240305133719.png]]

![[Pasted image 20231206173209.png]]

**8. é…ç½® Nginx**

```bash
# å¯åŠ¨æœåŠ¡
start nginx
# é€€å‡ºæœåŠ¡
nginx -s quit
# å¼ºåˆ¶å…³é—­æœåŠ¡
nginx -s stop
# é‡è½½æœåŠ¡
nginx -s reloadã€€ã€€ï¼ˆé‡è½½æœåŠ¡é…ç½®æ–‡ä»¶ï¼Œç±»ä¼¼äºé‡å¯ï¼ŒæœåŠ¡ä¸ä¼šä¸­æ­¢ï¼‰
# éªŒè¯é…ç½®æ–‡ä»¶
nginx -t
# ä½¿ç”¨é…ç½®æ–‡ä»¶
nginx -c "é…ç½®æ–‡ä»¶è·¯å¾„"
nginx -c /etc/nginx/nginx.conf
# ä½¿ç”¨å¸®åŠ©
nginx -h

systemctl start nginx
systemctl status nginx
```

a. æ‰“å¼€é…ç½®æ–‡ä»¶

```bash
vi /etc/nginx/nginx.conf
```

b. ç¼–è¾‘é…ç½®æ–‡ä»¶

æŒ‰ **`i`** è¿›å…¥ç¼–è¾‘æ¨¡å¼å¼€å§‹ç¼–è¾‘

c. ä¿å­˜

æŒ‰  **`ESC`** é€€å‡ºç¼–è¾‘æ¨¡å¼

è¾“å…¥ **`:wq`** ä¿å­˜å¹¶é€€å‡º

```
server {
        listen       80;
        listen       [::]:80;
        server_name  _;
        root         /usr/share/nginx/html;

        # Load configuration files for the default server block.
        include /etc/nginx/default.d/*.conf;

        error_page 404 /404.html;
        location = /404.html {
        }

        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
        }
    }

    server {
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
        add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';

        listen        1212;
        server_name   localhost;

        root          /usr/share/nginx/marry-travel-photos;
    }
```

d. ä¸Šä¼ æ–‡ä»¶

é€šè¿‡ **File Zilla** ä¸Šä¼ æ–‡ä»¶åˆ° `/usr/share/nginx/marry-travel-photos` ç›®å½•ä¸‹

**9. é‡å¯ Nginx**

```bash
nginx -s reload
```









### **ç»‘å®šå­åŸŸå**

å› ä¸ºæˆ‘çš„åŸŸåå·²ç»åœ¨å…¶ä»–åœ°æ–¹è§£æä½¿ç”¨äº†ï¼Œæ‰€ä»¥è¿™é‡Œå°±åªç»‘å®šå­åŸŸåã€‚

a. åˆ°é˜¿é‡Œäº‘çš„è§£æåŸŸåå¤„æ·»åŠ å­åŸŸå
b. åˆ°åŸŸåæœåŠ¡å•†æ·»åŠ  DNS record
c. å°†é˜¿é‡Œäº‘çš„å¯¹åº”çš„å€¼å¡«å†™åˆ°åŸŸåè§£æå¤„
d. å°†é˜¿é‡Œäº‘çš„DNSæ·»åŠ åˆ° NameCheap ä¸Š
e. å°†é˜¿é‡Œäº‘çš„è§£æè®°å½•ä¸­æ·»åŠ ä¸€æ¡è®°å½•ï¼Œè®°å½•å€¼ä¸ºæœåŠ¡å™¨çš„ IP åœ°å€
f. `ping aliyun.mmeme.me`


![[Pasted image 20231212175350.png]]

![[Pasted image 20231212175714.png]]

![[Pasted image 20231213093701.png]]

### **ç”³è¯· SSL**

> <https://letsencrypt.org/zh-cn/getting-started/>

**certbot**

> `let's encrypt`æ— éœ€æ³¨å†Œç™»å½•ï¼Œä¹Ÿèƒ½ç”Ÿæˆ`SSL`è¯ä¹¦ï¼Œéœ€è¦ç”¨åˆ°å®¢æˆ·ç«¯å·¥å…·ä¸º`certbot`ï¼Œè¯¥å·¥å…·æ˜¯ä½¿ç”¨`python`æ¥å†™çš„ï¼Œåœ¨`centos 7`ç³»ç»Ÿä¸‹ï¼Œè¯¥å·¥å…·å®‰è£…å¦‚ä¸‹:

- **å®‰è£…python3å’Œpip3**

```bash
yum install python3.9 python3-devel
```

- **å‡çº§pip3ï¼Œç‰ˆæœ¬è¦å¤§äº20**

```bash
pip3 install "pip>=20"
```

- **å®‰è£…å¿…è¦ä¾èµ–**

`setuptools-rust`æ˜¯`python`ä¸º`rust`æ‰©å±•æ‰€å¼€å‘çš„æ’ä»¶ï¼Œç›®çš„ä¸ºç”¨ `rust` ç¼–å†™çš„ `python` æ‰©å±•å°±åƒç”¨ C ç¼–å†™ä¸€æ ·å®¹æ˜“ã€‚

```bash
pip3 install setuptools-rust
```

- **å®‰è£…`certbot`**

```bash
pip3 install certbot
```

- **æ£€éªŒå®¢æˆ·ç«¯**

```bash
certbot --version
```

- **ç”³è¯·`SSL`è¯ä¹¦**

```bash
certbot certonly --standalone -d aliyun.mmeme.me
```


ğŸ› é‡åˆ°äº†æŠ¥é”™

```
Invalid version. The only valid version for X509Req is 0
```

```bash
pip install pyOpenSSL==22.1.0
pip install cffi==1.14
```