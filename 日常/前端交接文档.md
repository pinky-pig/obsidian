# 前端交接文档

## 一.项目概述（项目包有哪些，上传的地址是什么）

三个系统的代码结构几乎一样，只要业务视图逻辑不同，代码集中于 `src/views` 文件夹内。

### 1. 一体化指挥平台
消防核心项目，具有四大模块，数据展示、实时警情、警情复盘、化工平时（内嵌 iFrame，地址是平时系统）。
<https://192.168.150.218/svn/rjfw2021/应急管理事业部/项目/消防应急/前端/ls-command-disaster>

### 2. 江苏化工平时系统
主要是江苏省内一些数据展示面板。
<https://192.168.150.218/svn/rjfw2021/应急管理事业部/项目/消防应急/前端/ls-js-chemical>

### 3. 连云港化工平时系统
连云港的化工平时系统，前身跟江苏化工平时系统是一样的，但是后来连云港系统有一些特殊的需求，设计上跟江苏化工平时系统有冲突，所以独立出来一个仓库代码了。不过大致功能模块都是一样的，区别在于二维地图面板展示。
<https://192.168.150.218/svn/rjfw2021/应急管理事业部/项目/消防应急/前端/les-lyg-chemical>


## 二.技术栈（技术栈有哪些，中间件有哪些，重要的公共组件公共方法在哪可以找到）

- ⚡️ [Vue 3](https://github.com/vuejs/core), [Vite](https://github.com/vitejs/vite),[Vueuse](https://vueuse.org/guide/)

- 📥  两个组件库 - [NaiveUI](https://www.naiveui.com/zh-CN/os-theme) 、
[Element-Plus](https://element-plus.org/zh-CN/)

- 🍍 [使用 Pinia 的状态管理](https://pinia.vuejs.org)

- 🎨 [使用 UnoCSS 原子式 CSS](https://github.com/unocss/unocss) 以及 [Less 作为 CSS 库](https://lesscss.org/) 

- 📦 [使用 ECharts 进行数据可视化](https://echarts.apache.org/zh/index.html)

- 🔌 [使用 Axios 进行数据请求](https://github.com/axios/axios)

- 🔑 [使用 Vue Router 进行路由管理](https://router.vuejs.org/zh/)

- 📦 [使用 Vueuse 进行状态管理](https://vueuse.org/guide/)样式

- 🔥 `<script setup>` 语法

- 📥 [API 自动加载](https://github.com/unplugin/unplugin-auto-import)

- 🦾 [TypeScript 支持](https://www.typescriptlang.org/docs/)

- 😃 二维地图 - [高德地图 API](https://lbs.amap.com/api/javascript-api-v2/summary)

- 🗒 三维地图 - [公司内部鲸云平台](/public/CGS-2.3.0.23/)


## 三.模块说明（项目模块说明，项目入口，层级说明）

这里的说明分为整体和单个的详细说明，整体的文件目录描述，是这几个项目的共同部分，单个的详细说明，是各个项目业务的不同部分。

### 整体
- */.vscode* : vscode 配置
- */mock* : mock 数据
- */public* : 三维地图插件、接口配置 和 一些静态资源
- */.gitignore* : git 提交忽略项
- */auto-imports.d.ts* : vite-plugin-auto-import 插件生成
- */components.d.ts* : vite-plugin-components 插件生成
- */index.html* : 项目默认页面
- */src* : 源码
  - */src/assets* : 静态资源, 图片/字体 等
  - */src/components* : 通用组件
  - */src/hooks* : 一些 js 模块, 比如 logging, request 的封装。登录权限的封装
  - */src/router* : 路由配置
  - */src/service* : api层,不同的服务地址
  - */src/setup* : 安装相关 (比如第 3 方类库, 组件注册 等)
  - */src/store* : pinia 相关
  - */src/styles* : 公共样式
  - */src/typings* : ts 配置
  - */src/views* : 页面/视图
    - */src/views/login* : 登录页面
    - */src/views/home* : 主页
    - */src/views/error* : 404
- */vite.config.ts* : vite 配置
- */tsconfig.json* : typescript 配置
- */unocss.config.js* : typescript 配置


**接下来展示的是入口展示页面，是由一些单个小面板组件构成，而面板组件全部都在其同级文件内。而其具体有什么作用，都在页面视图中文字有所体现。**

### 一体化指挥平台


*/src/views/
  - dash/UserLogin.vue 登录页面
  - information 数据统计页面
  - dash 高德地图页面
  - chemical-layout 所有化工单位页面的父类布局
  - dash-chemical 警情所绑定的化工单位的信息数据页面
  - chemical 化工数据及化工三维模型页面
  - gaoceng-layout 所有高层页面的父类布局
  - dash-gaoceng 警情所绑定的高层单位的信息数据页面
  - gaoceng 高层单位数据及三维模型页面
  - replay-list 复盘功能列表页面
  - replay-map 单个警情复盘功能详情
  - ps-system 化工平时系统页面

### 江苏化工平时系统

*/src/views/
  - login 登录页面
  - statistics 数据展示页面
  - screen 二维地图页面
  - chemical 化工三维地图页面

### 连云港化工平时系统
这个系统跟上个江苏化工系统业务设计上是几乎一样的，但是新加了几个几个静态数据展示面板。静态面板都在同级文件夹下。
*/src/views/
- login 登录页面
- statistics 数据展示页面
- screen 二维地图页面
- chemical 化工三维地图页面


## 四.代码规范（主要的代码规范有哪些）

代码使用 ESLint 格式化，具体项目规则参见：`.eslintrc.js`。

提交代码描述也是经过 commitlint 检测，除非 `--force` ，具体规则参见 `commitlint.config.js`

### 文件名命名

这个主要是跟随阿里前端规范，具体内容百度就有。

- 项目命名 : 全部采用小写方式，以中线分隔。 `mall-management-system`  
- 目录命名 : 全部采用小写方式， 以中划线分隔，有复数结构时，要采用复数命名法， 缩写不用复数，使用 kebab-case 命名
    `head-search / page-loading / authorized / notice-icon`
- JS、CSS、SCSS、HTML、PNG 文件命名 : 全部采用小写方式， 以中划线分隔。 `render-dom.js /index.html / company-logo.png`


### 导入导出规范

涉及 node 端， 采用 CommonJS 规范。
业务开发不涉及 node 端，采用 ES Module 规范。

```ts
// CommonJS 

// ./utils/moduleA.ts
const name:string = "moduleA";
module.exports = { name } // 或者 `exports.name = name;`
// ./index.ts
const { name } = require("./foo.js");
console.log(name)  // moduleA

// ES Module
// ./utils/string.ts
export function createArr(defaultParams:string = 'Tom') {
  let allItems = Array.from(Array(100).keys(), (item,index) => {return {defaultParams,idx:item}});
  let fillArr = new Array(10).fill({defaultParams})
  return allItems
}
// ./index.ts
import { createArr } from './utils/string'
```

工具类文件夹及文件导出，默认 `index.ts` 文件导出本文件夹下所有的函数

```ts
// index.ts
export * from './common'
export * from './request'
```
`index.ts` 同级文件夹分功能模块采用 ES Module 导出
```ts
// ./common/index.ts
export * from './string'

// ./common/string.ts
export const pattern1 = /[?&]name=([^&]*)(&|$)/
```

### 组件开发

总之简单来说，组件内容较少，单文件组件。如果内容过长，Dom/JS分开，组合式API。Style 视组件内容复杂度，采用 `@apply`原子化 CSS及`CSS Module`。  

- Dom - 尽量使用 flex 、grid 布局  
  - [Icon](https://icones.netlify.app/collection/carbon) - 开源图标库
- CSS - TailwindCSS 、Less 、 CSS module   
- JS - 组合式

```html
<!-- icon -->
<div i-carbon-dicom-overlay />
```
```Less
// @apply 后面就是原子化 CSS。
.container {
  @apply w-full h-full;
  &:hover{
    transform:scale(1.2)
  }
}
```

```
// CSS Module 或者 scoped 
<style lang="less" module>
</style>
```
正常 simple 组件开发，照 vue 组件开发规范。
一般数量众多不可复制组件（譬如地图弹窗 Label）开发照如下规范：

```ts
import { Component } from "vue"
// CSS Module
import styles from "./index.module.less";

export function fightStationLabel(item?:stationItem) {
  let { props } = item ? item : {props:{label:'队站',value:'1车6人'}}
  return defineComponent({
    setup(props) { },
    render() {
      let dom =  
        <div class={styles.fightStationLabel}>
          <div class={styles.fightStationLabelLeft}>{props.label}</div>
          <div class={styles.fightStationLabelLeft}>{props.value}</div>
        </div>
      return dom
    },
  })
}

/** 其他队站 */
export function normalStationLabel(item?:stationItem) {
  let { props } = item ? item : {props:{label:'队站',value:'出警'}}
  return  defineComponent({
    setup() { },
    render() {
      let dom =  
        <div class={styles.normalStationLabel}>
          <div class={props.label ? styles.normalStationLabelLeft : ''} >{props.label}</div>
          <div class={props.value ? styles.normalStationLabelRight : ''} >{props.value}</div>
        </div>
      return dom
    },
  })
}
```

### JS 开发

通过文件夹命名含义， `index.ts` export 所有。可参考如下

目录如下：
- utils
  - index.ts
  - string.ts

```ts
// ./utils/index.ts
export * from './string.ts'

// ./utils/string.ts
export function fn(){
  return 'fn'
}

// 使用
import { fn } from '~/utils'
fn()
```


### 编辑器使用及代码规范
Vscode 编辑器设置及插件
配置详见 ` .vscode / extension.json ./settings.json`

### 目录结构及开发注意事项

- 代码缩进
  - 2 个空格 
  - 提交代码前注意检查代码缩进 (js & css), 避免提交缩进混乱的代码
- vue 组件命名: 使用 PascalCase 命名法 (组件文件名也遵循该规则), 比如 Foo.vue/FooBar.vue
- 组件默认通过接口从后台获取数据的函数，命名为 `fetchData()`，
    比如一个组件首先要列表获取数据，才进行后续增删改操作，这个列表获取数据的函数，命名为 `fetchData()`

## 五.开发环境（数据库脚本，环境说明）

Node版本： 最新的就行

### 项目启动

- 安装依赖

  ```bash
  npm install
  ```

- 启动服务

  ```bash
  npm run dev
  ```

- 打包

  ```bash
  npm run build
  ```

## 六.打包上线（打包上线需要注意的地方，包括配置等方面）

如果要修改打包配置，可以修改 `/public/config/` 文件夹下的 `config.js` 文件。这个文件还有一些其他的静态变量，比如系统名称，具体是否修改看需求。

运行命令：
```bash
npm run build
```

会生成 dist 文件夹，里面就是打包好的文件，部署就好了。
