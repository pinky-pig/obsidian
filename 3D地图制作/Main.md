
> 结合 QGIS 和 Blender 制作 3D 地图，首先需要简单理解几个概念。
> 1. Blender 处理的是 3D 模型
> 2. 高程数据通常是以栅格形式存在的
> 所以一般需要几个步骤

## **步骤**

- **获取高程数据：** 使用公开数据
- **选择区域和分辨率：** 在获取高程数据时，选择你感兴趣的地理区域以及适当的分辨率。较高的分辨率将提供更详细的地形信息，但可能需要更多的存储和处理资源。
- **数据格式转换：** 大多数高程数据以栅格格式存在，如GeoTIFF、DEM等。需要将数据转换为Blender能够理解的格式，通常是高程地形的3D模型。
- **导入Blender：** 一旦获得了3D模型的高程数据，可以将其导入Blender。你可以使用Blender的导入工具，通常支持多种3D模型格式，如STL、OBJ等。导入后，高程数据将成为Blender中的3D对象。
- **调整和渲染：** 在Blender中，可以对导入的高程数据进行调整、编辑和渲染。可以为其添加纹理、颜色，也可以进行地形细节的编辑和渲染设置。
- **光照和摄影机设置：** 为了获得逼真的渲染效果，还可以设置光照和摄影机视角，以便呈现出高程数据的立体感和质感。
- **渲染和输出：** 最后，可以使用Blender的渲染引擎来呈现高程数据，并将渲染结果导出为图像或视频文件，以便在其他项目中使用。


## **简单流程**


### QGIS 处理数据

- **下载高程：** <https://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/elevation/copernicus-dem/elevation>
- **导入 QGIS ：** 直接拖拽进来就行了。这里 ttf 文件 。
- **合并 ：** 下载的高程数据都是一方块一方块的，所以可能跟期待的地区不一致，需要修改。
- - **1.** 这里执行合并操作，上面下载了两个高程数据，然后直接拖拽进 QGIS ，会在左侧图层面板看到有两个图层。
- - **2.** 因为高程地理数据是有空间信息的，所以两个高程数据自然会按真实的拼接在一起（下载的地图上在哪就在哪位置）
- - **3.** 开始合并！找到 QGIS 最上面操作栏的“栅格（Raster）”，因为高程数据就是以栅格存在的，所以这里操作高程数据最理所当然，然后往下面找到“合并（merge）”，可能二级目录没有，那就在三级目录下。点击合并后，会出来弹窗，然后在“参数” Tab 下找到“输入图层”，然后选择要合并的那两个图层，再点击“运行”，然后就静等合并完成，会看到图层面板新增一个图层，就是合并后的图层了。
- - **3.1** 快捷键操作：点击上面的“数据梳理”，点开工具箱（Ctrl+ALt+T），然后右侧会有工具箱面板，在搜索栏输入“merge”，就筛选到合并了，双击运行同上步骤。
- **裁剪 ：** 自然还是找到“栅格” -> “提取” -> "按范围提取" 。图层选择刚才合并过的，裁剪范围选择最右边的下拉框，点击找到“在地图画布中绘制”，然后就能绘制所要裁剪的范围了。直接运行，静等裁剪完成，同样会新增一个裁剪后的图层。
- **重投影 ：** 这一步骤就是为了让效果更好，但是还是要自己观察哪种效果更好。这里在“栅格” -> “投影” -> "变形（重投影）"，在弹窗中设置“要使用的重采样方法”为 "Lanczos Windowed Sinc"，点击运行就好了。快捷方式是工具箱面板筛选“Wrap”。
- **拉伸 ：** 高程数据，就是地面高度，从底部到天空，一般情况下是0到4000左右。因为我们要最终导入到 Blender ，要在 Blender 中能够看的清楚地势差，而一般范围太大，地势差不明显，是平坦的。所以我们要拉伸，在视觉上看的出来，满足视觉效果，当然这跟实际不一致了，但是要看的是地势差对比，所以应该还是影响不大。而且两个软件的精度不一致，高程是小数，Blender是整数，从 QGIS 导出然后导入到 Blender 中，小数自然会被舍去，数据丢失，那么模型细节就会缺失。但是要拉伸，那么就需要拉伸公式，这里抄一个 `(像素值-最低值)/(最高值-最低值)*65535` ，这里QGIS是 `("mountain@1"-42)/(2283-42)*65535` 。那么找到“栅格”->“栅格计算器” （快捷方式是在工具箱面板输入 `Raster Calculator`），然后输入公式运行。
- **转换像素类型 ：** 在“合并（merge）”的时候，设置“输出数据类型”为“UInt16”


### Blender 处理模型

- **切换引擎 ：** 右侧工具栏 `scene` 更改，使用 Cycles 渲染引擎，并开启试验特性。（目的用一些新功能，不换也行）
- **初始化画布：** 找到要到 tif 文件，右键属性，查看分辨率。在 blender 工程中，删除默认的立方体，添加一个平面，在右侧设置 scene 的 x  y 值跟 tif 的分辨率保持一致。为了让模型场景跟要渲染的高程数据尺寸一样大。
- 
